import requests
from bs4 import BeautifulSoup
from tqdm import tqdm
from termcolor import colored

class UrlScraper:

    def __init__(self, base_url, num_pages):

        self.base_url = base_url
        self.num_pages = num_pages
        self.links = []

    def scrape_vulnerability_urls(self):

        with tqdm(total=self.num_pages,desc=colored("Scraping URL", "cyan"),colour="MAGENTA") as pbar:

            for page in range(1, self.num_pages + 1):

                url = f"{self.base_url}{page}"
                response = requests.get(url)

                soup = BeautifulSoup(response.text, "html.parser")

                div = soup.find_all("div", class_="vue--block vulns-table__wrapper base-block")

                a = div[0].find_all("a", attrs={"data-snyk-test": "vuln table title"})

                for link in a:
                    
                    vulnerability_url = link["href"]
                    normalized_url = f"https://security.snyk.io/{vulnerability_url}"
                    self.links.append(normalized_url)

                pbar.update(1)

        return self.links
    


